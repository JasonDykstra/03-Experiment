<script src="https://d3js.org/d3.v4.min.js"></script>
<html>
<body>
<script>
    console.log(d3); // test if d3 is loaded

    //window.onload=drawBarChart();
    window.onload=startPage();

    var userInput;
    const csvRows = [["Type", "Smaller", "Larger", "Actual Ratio", "Guess Ratio"]];

    var tempData;

    var numSubmits = 0;
    var maxSubmits = 3;

    function startPage(){
        var start = document.createElement("BUTTON");
        var startText = document.createTextNode("Start");
        start.appendChild(startText);
        document.body.appendChild(start);
        start.classList.add('StartButton')
        start.classList.add('StartPage')
        start.onclick = function(){drawBarChart()}

    }

    function resultsPage(csvContent){
        var encodedUri = encodeURI(csvContent);
        window.open(encodedUri);
    }

    function textBoxSubmit(){
        // Text box
        var textInput = document.createElement("INPUT");
        textInput.setAttribute("placeholder","Enter Percent E.g. 50");
        textInput.setAttribute("type","text");
        document.body.appendChild(textInput);
        var percentIcon = document.createElement("Percent");
        var percentIconText = document.createTextNode("%    ");
        percentIcon.style.fontFamily = "arial";
        percentIcon.appendChild(percentIconText);
        document.body.appendChild(percentIcon);

        // Submit button
        var submit = document.createElement("Button");
        var submitText = document.createTextNode("Submit");
        submit.appendChild(submitText);
        document.body.appendChild(submit);
        submit.onclick = function(){
            numSubmits++;
            var text = textInput.value;
            console.log(text);
            //userInput = text;

            // Update the csv
            tempData.push(text);
            csvRows.push(tempData);
            let csvContent = "data:text/csv;charset=utf-8,";
            csvRows.forEach(function (rowArray) {
                let row = rowArray.join(",");
                csvContent += row + "\r\n";
            });

            console.log(csvRows);

            if(numSubmits < maxSubmits) drawBarChart();
            else resultsPage(csvContent);
        }
    }

  //  function resultsPage

    function drawBarChart() {

        // Clear the screen
        document.body.innerHTML = '';

        // Draw the text box for the user to submit data
        textBoxSubmit();

        // SVG dimensions
        var SVGWidth = 800;
        var SVGHeight = 600;
        //var margins = window.innerWidth/10;
        var margins = 50;

        var barWidth = 50;
        var barPadding = 5;

        // Random Dataset Method 2 (JavaScript Random Number Generation)
        var data2 = [];
        var numDataPoints = 0;
        var maxDataPoints = 8;
        while (numDataPoints < maxDataPoints) {
            var newNumber = Math.random();
            if (newNumber > 0.1) {
                data2.push(newNumber);
                numDataPoints++;
            }
        }

        var twoDots = [];
        while (twoDots.length < 2) {
            var dotIndex = Math.floor(Math.random() * maxDataPoints);
            if (twoDots.length == 1 && twoDots[0] != dotIndex) {
                twoDots[1] = dotIndex;
            } else if (twoDots.length == 0) {
                twoDots[0] = dotIndex;
            }
        }

        console.log("Two dots: " + twoDots);


        // // Random Dataset Method 3 (D3 Random Number Generation)
        // var data3 = d3.range(10).map(function() {
        //     return Math.random();
        // });

        // Concatinate the 3 Random Datasets
        //var data = data1.concat(data2, data2);
        console.log(data2);


        // Display a simple Column Chart using the above Random Data
        //var svg = d3.select('#chartholder').selectAll('div')
        var svg = d3.select("body")
                .append("svg")
                .attr("width", SVGWidth)
                .attr("height", SVGHeight)
            //.append("g")
        ;

        // Bar Chart
        svg.selectAll("bar")
            .data(data2)
            .enter()
            .append("rect")
            .attr('class', 'bar')
            .style('height', function (d) {
                return d * 500 + 'px';
            })
            .style('width', barWidth - barPadding)
            .attr("y", function (d) {
                return SVGHeight - d * 500 - barPadding;
            })
            //.attr("transform", "translate(" + margins + "," + margins + ")")
            .attr("transform", function (d, i) {
                var translate = [barPadding + barWidth * i, 0];
                return "translate(" + translate + ")";
            })
            .style("stroke", "black")
            .style("stroke-width", 3)
            .style("fill", "none")
        ;

        svg.append('circle')
            .attr("cx", (twoDots[0] * (barWidth)) + barWidth / 2 + barPadding / 2)
            .attr("cy", SVGHeight - 15)
            .attr("r", 10)
            .style("fill", "black");
        svg.append('circle')
            .attr("cx", (twoDots[1] * (barWidth)) + barWidth / 2 + barPadding / 2)
            .attr("cy", SVGHeight - 15)
            .attr("r", 10)
            .style("fill", "black");

        var smallerBarHeight = Math.min(data2[twoDots[0]], data2[twoDots[1]]);

        var largerBarHeight = Math.max(data2[twoDots[0]], data2[twoDots[1]]);

        // Shrink bar heights to 4 decimal places
        smallerBarHeight = Math.round(smallerBarHeight * 100000) / 100000;
        largerBarHeight = Math.round(largerBarHeight * 100000) / 100000;

        var ratio = Math.round((smallerBarHeight / largerBarHeight) * 100000) / 100000;

        console.log("Large dot: " + largerBarHeight);
        console.log("Smaller dot: " + smallerBarHeight);
        console.log("Ratio: " + ratio);


        tempData = ["Bar", smallerBarHeight, largerBarHeight, ratio];


    }


    // // Margins
    // var margins = {left: 50, right: 50, top: 50, bottom: 50},
    //     width = SVGWidth - margins.left - margins.right,
    //     height = SVGHeight - margins.top - margins.bottom;
    //
    // // Axis limits and bubble profiles
    // var x = d3.scaleLinear().range([0, width]);
    // var y = d3.scaleLinear().range([height, 0]);
    // var bubbleSize = d3.scaleLinear().range([3, 20]);
    // var bubbleColors = d3.scaleOrdinal().range(["red", "blue", "orange", "green", "purple"]);
    //
    // // SVG
    // var svg = d3.select("body")
    //     .append("svg")
    //     .attr("width", SVGWidth)
    //     .attr("height", SVGHeight)
    //     .append("g")
    //     .attr("transform", "translate(" + margins.left + "," + margins.top + ")");
    //
    // // Load CSV
    // d3.csv("cars-sample.csv", function(error, data){
    //     if (error) throw error;
    //
    //     // Format
    //     data.forEach(function(d) {
    //         d.Weight = +d.Weight;
    //         d.MPG = +d.MPG;
    //         d.size = +d.Weight;
    //     });
    //
    //     // Domains
    //     x.domain([1500, 5200]);
    //     y.domain([8, 48]);
    //     bubbleSize.domain([1500, 5000]);
    //     bubbleColors.domain(["ford", "toyota", "bmw", "honda", "mercedes"]);
    //
    //     // Define major and minor ticks & grid
    //     function xGridLines(){
    //         return d3.axisBottom(x);
    //     }
    //
    //     function yGridLines(){
    //         return d3.axisLeft(y);
    //     }
    //
    //     // Draw major and minor ticks & grid
    //     svg.append("g")
    //         .attr("class", "major-axis-grid")
    //         .attr("transform", "translate(0, " + height + ")")
    //         .call(xGridLines().tickSize(-height).tickFormat(""));
    //
    //     svg.append("g")
    //         .attr("class", "major-axis-grid")
    //         .call(yGridLines().tickSize(-width).tickFormat(""));
    //
    //     // Axes
    //     svg.append("g")
    //         .attr("transform", "translate(0, " + height + ")")
    //         .call(d3.axisBottom(x).ticks(3));
    //
    //     svg.append("g")
    //         .call(d3.axisLeft(y).ticks(4));
    //
    //     // Axis labels
    //     svg.append("text")
    //         .attr("transform", "translate(" + (width/2) + ", " + (height + margins.top - 10) + ")")
    //         .style("text-anchor", "middle")
    //         .text("Weight")
    //         .style("font", "18px arial")
    //
    //     svg.append("text")
    //         .attr("transform", "rotate(-90)")
    //         .attr("y", 0 - margins.left)
    //         .attr("x", 0 - (height/2))
    //         .attr("dy", "1em")
    //         .style("text-anchor", "middle")
    //         .text("MPG")
    //         .style("font", "18px arial");
    //
    //     // Bubble Plot
    //     svg.selectAll("dot")
    //         .data(data)
    //         .enter()
    //         .append("circle")
    //         .attr("r", function(d) { return bubbleSize(d.size);})
    //         .attr("cx", function(d) { return x(d.Weight);})
    //         .attr("cy", function(d) { return y(d.MPG);})
    //         .style("fill", function(d) { return bubbleColors(d.Manufacturer);})
    //         .attr("fill-opacity", 0.5);
    //
    //
    //
    //
    // });


</script>
</body>
</html>
<style>
    .svg{
        background-color: saddlebrown;
    }
    #chartholder {
        height: 400px;
        width: 600px;
    }
    .bar {
        display: inline-block;
        width: 15px;
        height: 10px; /* Gets overridden by D3 height below */
        margin-right: 2px;
        background-color: teal;
    }
</style>
