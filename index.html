<!DOCTYPE html>
<html>
<head>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <title>03-Experiment.html</title>
</head>
<body>
<script>
    console.log(d3); // test if d3 is loaded

    //window.onload=drawBarChart();
    window.onload = startPage();

    const csvRows = [["Type", "Smaller", "Larger", "Actual Ratio", "Guess Ratio"]];

    var tempData;

    var numSubmits = 0;
    var maxSubmits = 3;

    function startPage() {

        var startDiv = document.createElement("div");
        startDiv.style.height = "100px";
        startDiv.id = "startDiv";
        document.body.appendChild(startDiv);

        var intro = document.createElement("p");
        startDiv.appendChild(intro);

        var start = document.createElement("BUTTON");
        var startText = document.createTextNode("Start");
        start.appendChild(startText);
        startDiv.appendChild(start);

        start.classList.add('StartButton')
        start.classList.add('StartPage')
        start.onclick = function () {
            drawBarChart()
        }

    }

    function resultsPage(csvContent) {
        var encodedUri = encodeURI(csvContent);
        window.open(encodedUri);
    }

    function textBoxSubmit() {
        var div = document.createElement("div");

        div.style.height = "100px";

        document.body.appendChild(div);

        // Text box
        var textInput = document.createElement("INPUT");
        textInput.setAttribute("placeholder", "Enter Percent E.g. 50");
        textInput.setAttribute("type", "text");
        div.appendChild(textInput);
        var percentIcon = document.createElement("Percent");
        var percentIconText = document.createTextNode("%");
        percentIcon.id = "percentIcon";
        percentIcon.style.fontFamily = "arial";
        percentIcon.appendChild(percentIconText);
        div.appendChild(percentIcon);

        // Submit button
        var submit = document.createElement("Button");
        var submitText = document.createTextNode("Submit");

        submit.appendChild(submitText);
        div.appendChild(submit);
        submit.onclick = function () {
            if (textInput.value < 100 && textInput.value > 0) {
                numSubmits++;
                var text = textInput.value;
                console.log(text);
                //userInput = text;

                // Update the csv
                tempData.push(text);
                csvRows.push(tempData);
                let csvContent = "data:text/csv;charset=utf-8,";
                csvRows.forEach(function (rowArray) {
                    let row = rowArray.join(",");
                    csvContent += row + "\r\n";
                });

                console.log(csvRows);
                if (numSubmits < maxSubmits) drawPieChart();
                else resultsPage(csvContent);
            }else{
                alert("Please type a number less than 100")
            }

        }
    }

    //  function resultsPage

    function drawBarChart() {

        // Clear the screen
        document.body.innerHTML = '';

        // Draw the text box for the user to submit data
        textBoxSubmit();

        // SVG dimensions
        var SVGWidth = 405;
        var SVGHeight = 600;
        //var margins = window.innerWidth/10;
        var margins = 50;

        var barWidth = 50;
        var barPadding = 5;

        // Random Dataset Method 2 (JavaScript Random Number Generation)
        var data2 = [];
        var numDataPoints = 0;
        var maxDataPoints = 8;
        while (numDataPoints < maxDataPoints) {
            var newNumber = Math.random();
            if (newNumber > 0.1) {
                data2.push(newNumber);
                numDataPoints++;
            }
        }

        var twoDots = [];
        while (twoDots.length < 2) {
            var dotIndex = Math.floor(Math.random() * maxDataPoints);
            if (twoDots.length == 1 && twoDots[0] != dotIndex) {
                twoDots[1] = dotIndex;
            } else if (twoDots.length == 0) {
                twoDots[0] = dotIndex;
            }
        }

        console.log("Two dots: " + twoDots);

        console.log(data2);

        var svgdiv = document.createElement("div");
        svgdiv.classList.add("svgdiv");
        document.body.appendChild(svgdiv);
        svgdiv.id = "svgdiv";
        var svg = d3.select("#svgdiv")
                .append("svg")
                .attr("width", SVGWidth)
                .attr("height", SVGHeight);

        // Bar Chart
        svg.selectAll("bar")
            .data(data2)
            .enter()
            .append("rect")
            .attr('class', 'bar')
            .style('height', function (d) {
                return d * 500 + 'px';
            })
            .style('width', barWidth - barPadding)
            .attr("y", function (d) {
                return SVGHeight - d * 500 - barPadding;
            })

            .attr("transform", function (d, i) {
                var translate = [barPadding + barWidth * i, 0];
                return "translate(" + translate + ")";
            })
            .style("stroke", "black")
            .style("stroke-width", 3)
            .style("fill", "none")
        ;

        svg.append('circle')
            .attr("cx", (twoDots[0] * (barWidth)) + barWidth / 2 + barPadding / 2)
            .attr("cy", SVGHeight - 15)
            .attr("r", 10)
            .style("fill", "black");
        svg.append('circle')
            .attr("cx", (twoDots[1] * (barWidth)) + barWidth / 2 + barPadding / 2)
            .attr("cy", SVGHeight - 15)
            .attr("r", 10)
            .style("fill", "black");

        var smallerBarHeight = Math.min(data2[twoDots[0]], data2[twoDots[1]]);

        var largerBarHeight = Math.max(data2[twoDots[0]], data2[twoDots[1]]);

        // Shrink bar heights to 4 decimal places
        smallerBarHeight = Math.round(smallerBarHeight * 100000) / 100000;
        largerBarHeight = Math.round(largerBarHeight * 100000) / 100000;

        var ratio = Math.round((smallerBarHeight / largerBarHeight) * 100000) / 100000;

        console.log("Large dot: " + largerBarHeight);
        console.log("Smaller dot: " + smallerBarHeight);
        console.log("Ratio: " + ratio);


        tempData = ["Bar", smallerBarHeight, largerBarHeight, ratio];


    }

    function drawPieChart(){

        d3.selectAll("svg > *").remove();


        // Random Dataset Method 2 (JavaScript Random Number Generation)
        var data2 = [];
        var numDataPoints = 0;
        var maxDataPoints = 9;
        while (numDataPoints < maxDataPoints) {
            var newNumber = Math.random();
            if (newNumber > 0.1) {
                data2.push(newNumber);
                numDataPoints++;
            }
        }

        var width = 360;
        var height = 360;
        var radius = Math.min(width, height) / 3;

        var color = d3.scaleOrdinal(d3.schemeCategory20b);

        svg = d3.select('#svgdiv')
            .append('svg')
            .attr('width', width)
            .attr('height', height)
            .append('g')
            .attr('transform', 'translate(' + (width / 2) +
                ',' + (height / 2) + ')');

        var arc = d3.arc()
            .innerRadius(0)
            .outerRadius(radius);

        var pie = d3.pie()
            .value(function(d) { return d; })
            .sort(null);

        var path = svg.selectAll('path')
            .data(pie(data2))
            .enter()
            .append('path')
            .attr('d', arc)
            .attr('fill', "white")
            .style("stroke","black")
            .style("stroke-width",3);

        var twoDots = [];
        while (twoDots.length < 2) {
            var dotIndex = Math.floor(Math.random() * maxDataPoints);
            if (twoDots.length == 1 && twoDots[0] != dotIndex) {
                twoDots[1] = dotIndex;
            } else if (twoDots.length == 0) {
                twoDots[0] = dotIndex;
            }
        }

        var smallerWedge = Math.min(data2[twoDots[0]], data2[twoDots[1]]);

        var largerWedge = Math.max(data2[twoDots[0]], data2[twoDots[1]]);


    }
</script>
</body>
</html>
